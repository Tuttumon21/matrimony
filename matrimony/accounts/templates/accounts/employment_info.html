{% extends 'shared/base.html' %}

{% block content %}
<div class="row">
  <div class="col-sm-8 offset-sm-2 mt-5 shadow p-4">
    <h1 class="text-center">Update Employment Status</h1>
    <!-- Progress Bar -->
    <div class="progress mb-4">
      <div class="progress-bar progress-bar-striped progress-bar-animated" 
           role="progressbar" 
           aria-label="Progress"
           aria-valuenow="{{ user.profile_completed }}" 
           aria-valuemin="0" 
           aria-valuemax="100"
           style="width: {{ user.profile_completed }}%;">
        {{ user.profile_completed }}%
      </div>
    </div>
    
    <form method="post">
      {% csrf_token %}
      
      <!-- Employment status selection field -->
      {% include 'components/form_field.html' with field=form.employment_status %}

      <!-- Conditional fields for employee/employer -->
      <div id="employee_fields" style="display: none;">
        {% include 'components/form_field.html' with field=form.company_name %}
        {% include 'components/form_field.html' with field=form.designation %}
        {% include 'components/form_field.html' with field=form.work_location %}
      </div>

      <!-- Conditional fields for job seeker -->
      <div id="jobseeker_fields" style="display: none;">
        {% include 'components/form_field.html' with field=form.job_title %}
        {% include 'components/form_field.html' with field=form.expert_level %}
      </div>

      <div class="d-grid">
        <button type="submit" class="btn btn-success my-3">Save</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const employmentStatusField = document.getElementById('id_employment_status');
    const employeeFields = document.getElementById('employee_fields');
    const jobseekerFields = document.getElementById('jobseeker_fields');

    const companyName = document.getElementById('id_company_name');
    const designation = document.getElementById('id_designation');
    const workLocation = document.getElementById('id_work_location');
    const jobTitle = document.getElementById('id_job_title');
    const expertLevel = document.getElementById('id_expert_level');

    function toggleFields() {
      const value = employmentStatusField.value;
      if (value === 'employee' || value === 'employer') {
        employeeFields.style.display = 'block';
        jobseekerFields.style.display = 'none';
        companyName.required = true;
        designation.required = true;
        workLocation.required = true;
        jobTitle.required = false;
        expertLevel.required = false;
      } else if (value === 'jobseeker') {
        employeeFields.style.display = 'none';
        jobseekerFields.style.display = 'block';
        companyName.required = false;
        designation.required = false;
        workLocation.required = false;
        jobTitle.required = true;
        expertLevel.required = true;
      } else {
        employeeFields.style.display = 'none';
        jobseekerFields.style.display = 'none';
        companyName.required = false;
        designation.required = false;
        workLocation.required = false;
        jobTitle.required = false;
        expertLevel.required = false;
      }
    }

    employmentStatusField.addEventListener('change', toggleFields);
    toggleFields();  // Initial call to set the correct visibility and required attribute
  });
</script>
{% endblock %}
